/* yui-3.9.1/node-focusmanager/node-focusmanager-min.js */
/* YUI 3.9.1 (build 5852) Copyright 2013 Yahoo! Inc. http://yuilibrary.com/license/ */
YUI.add("node-focusmanager",function(e,t){var n="activeDescendant",r="id",i="disabled",s="tabIndex",o="focused",u="focusClass",a="circular",f="UI",l="key",c=n+"Change",h="host",p={37:!0,38:!0,39:!0,40:!0},d={a:!0,button:!0,input:!0,object:!0},v=e.Lang,m=e.UA,g=function(){g.superclass.constructor.apply(this,arguments)};g.ATTRS={focused:{value:!1,readOnly:!0},descendants:{getter:function(e){return this.get(h).all(e)}},activeDescendant:{setter:function(t){var n=v.isNumber,i=e.Attribute.INVALID_VALUE,s=this._descendantsMap,o=this._descendants,u,a,f;return n(t)?(u=t,a=u):t instanceof e.Node&&s?(u=s[t.get(r)],n(u)?a=u:a=i):a=i,o&&(f=o.item(u),f&&f.get("disabled")&&(a=i)),a}},keys:{value:{next:null,previous:null}},focusClass:{},circular:{value:!0}},e.extend(g,e.Plugin.Base,{_stopped:!0,_descendants:null,_descendantsMap:null,_focusedNode:null,_lastNodeIndex:0,_eventHandlers:null,_initDescendants:function(){var t=this.get("descendants"),o={},u=-1,a,f=this.get(n),l,c,h=0;v.isUndefined(f)&&(f=-1);if(t){a=t.size();for(h=0;h<a;h++)l=t.item(h),u===-1&&!l.get(i)&&(u=h),f<0&&parseInt(l.getAttribute(s,2),10)===0&&(f=h),l&&l.set(s,-1),c=l.get(r),c||(c=e.guid(),l.set(r,c)),o[c]=h;f<0&&(f=0),l=t.item(f);if(!l||l.get(i))l=t.item(u),f=u;this._lastNodeIndex=a-1,this._descendants=t,this._descendantsMap=o,this.set(n,f),l&&l.set(s,0)}},_isDescendant:function(e){return e.get(r)in this._descendantsMap},_removeFocusClass:function(){var e=this._focusedNode,t=this.get(u),n;t&&(n=v.isString(t)?t:t.className),e&&n&&e.removeClass(n)},_detachKeyHandler:function(){var e=this._prevKeyHandler,t=this._nextKeyHandler;e&&e.detach(),t&&t.detach()},_preventScroll:function(e){p[e.keyCode]&&this._isDescendant(e.target)&&e.preventDefault()},_fireClick:function(e){var t=e.target,n=t.get("nodeName").toLowerCase();e.keyCode===13&&(!d[n]||n==="a"&&!t.getAttribute("href"))&&t.simulate("click")},_attachKeyHandler:function(){this._detachKeyHandler();var t=this.get("keys.next"),n=this.get("keys.previous"),r=this.get(h),i=this._eventHandlers;n&&(this._prevKeyHandler=e.on(l,e.bind(this._focusPrevious,this),r,n)),t&&(this._nextKeyHandler=e.on(l,e.bind(this._focusNext,this),r,t)),m.opera&&i.push(r.on("keypress",this._preventScroll,this)),m.opera||i.push(r.on("keypress",this._fireClick,this))},_detachEventHandlers:function(){this._detachKeyHandler();var t=this._eventHandlers;t&&(e.Array.each(t,function(e){e.detach()}),this._eventHandlers=null)},_attachEventHandlers:function(){var t=this._descendants,n,r,i;t&&t.size()&&(n=this._eventHandlers||[],r=this.get(h).get("ownerDocument"),n.length===0&&(n.push(r.on("focus",this._onDocFocus,this)),n.push(r.on("mousedown",this._onDocMouseDown,this)),n.push(this.after("keysChange",this._attachKeyHandler)),n.push(this.after("descendantsChange",this._initDescendants)),n.push(this.after(c,this._afterActiveDescendantChange)),i=this.after("focusedChange",e.bind(function(e){e.newVal&&(this._attachKeyHandler(),i.detach())},this)),n.push(i)),this._eventHandlers=n)},_onDocMouseDown:function(e){var t=this.get(h),n=e.target,r=t.contains(n),i,s=function(e){var n=!1;return e.compareTo(t)||(n=this._isDescendant(e)?e:s.call(this,e.get("parentNode"))),n};r&&(i=s.call(this,n),i?n=i:!i&&this.get(o)&&(this._set(o,!1),this._onDocFocus(e))),r&&this._isDescendant(n)?this.focus(n):m.webkit&&this.get(o)&&(!r||r&&!this._isDescendant(n))&&(this._set(o,!1),this._onDocFocus(e))},_onDocFocus:function(e){var t=this._focusTarget||e.target,n=this.get(o),r=this.get(u),i=this._focusedNode,s;this._focusTarget&&(this._focusTarget=null),this.get(h).contains(t)?(s=this._isDescendant(t),!n&&s?n=!0:n&&!s&&(n=!1)):n=!1,r&&(i&&(!i.compareTo(t)||!n)&&this._removeFocusClass(),s&&n&&(r.fn?(t=r.fn(t),t.addClass(r.className)):t.addClass(r),this._focusedNode=t)),this._set(o,n)},_focusNext:function(e,t){var r=t||this.get(n),i;this._isDescendant(e.target)&&r<=this._lastNodeIndex&&(r+=1,r===this._lastNodeIndex+1&&this.get(a)&&(r=0),i=this._descendants.item(r),i&&(i.get("disabled")?this._focusNext(e,r):this.focus(r))),this._preventScroll(e)},_focusPrevious:function(e,t){var r=t||this.get(n),i;this._isDescendant(e.target)&&r>=0&&(r-=1,r===-1&&this.get(a)&&(r=this._lastNodeIndex),i=this._descendants.item(r),i&&(i.get("disabled")?this._focusPrevious(e,r):this.focus(r))),this._preventScroll(e)},_afterActiveDescendantChange:function(e){var t=this._descendants.item(e.prevVal);t&&t.set(s,-1),t=this._descendants.item(e.newVal),t&&t.set(s,0)},initializer:function(e){this.start()},destructor:function(){this.stop(),this.get(h).focusManager=null},focus:function(e){v.isUndefined(e)&&(e=this.get(n)),this.set(n,e,{src:f});var t=this._descendants.item(this.get(n));t&&(t.focus(),m.opera&&t.get("nodeName").toLowerCase()==="button"&&(this._focusTarget=t))},blur:function(){var e;this.get(o)&&(e=this._descendants.item(this.get(n)),e&&(e.blur(),this._removeFocusClass()),this._set(o,!1,{src:f}))},start:function(){this._stopped&&(this._initDescendants(),this._attachEventHandlers(),this._stopped=!1)},stop:function(){this._stopped||(this._detachEventHandlers(),this._descendants=null,this._focusedNode=null,this._lastNodeIndex=0,this._stopped=!0)},refresh:function(){this._initDescendants(),this._eventHandlers||this._attachEventHandlers()}}),g.NAME="nodeFocusManager",g.NS="focusManager",e.namespace("Plugin"),e.Plugin.NodeFocusManager=g},"3.9.1",{requires:["attribute","node","plugin","node-event-simulate","event-key","event-focus"]});

/* yui-3.9.1/node-menunav/node-menunav-min.js */
/* YUI 3.9.1 (build 5852) Copyright 2013 Yahoo! Inc. http://yuilibrary.com/license/ */
YUI.add("node-menunav",function(e,t){var n=e.UA,r=e.later,i=e.ClassNameManager.getClassName,s="menu",o="menuitem",u="hidden",a="parentNode",f="children",l="offsetHeight",c="offsetWidth",h="px",p="id",d=".",v="handledMouseOut",m="handledMouseOver",g="active",y="label",b="a",w="mousedown",E="keydown",S="click",x="",T="first-of-type",N="role",C="presentation",k="descendants",L="UI",A="activeDescendant",O="useARIA",M="aria-hidden",_="content",D="host",P=A+"Change",H="autoSubmenuDisplay",B="mouseOutHideDelay",j=i(s),F=i(s,u),I=i(s,"horizontal"),q=i(s,y),R=i(s,y,g),U=i(s,y,s+"visible"),z=i(o),W=i(o,g),X=d+j,V=d+i(s,"toggle"),$=d+i(s,_),J=d+q,K=">"+$+">ul>li>a",Q=">"+$+">ul>li>"+J+">a:first-child",G=function(e){var t=e.previous(),n;return t||(n=e.get(a).get(f),t=n.item(n.size()-1)),t},Y=function(e){var t=e.next();return t||(t=e.get(a).get(f).item(0)),t},Z=function(e){var t=!1;return e&&(t=e.get("nodeName").toLowerCase()===b),t},et=function(e){return e.hasClass(z)},tt=function(e){return e.hasClass(q)},nt=function(e){return e.hasClass(I)},rt=function(e){return e.hasClass(U)},it=function(e){return Z(e)?e:e.one(b)},st=function(e,t,n){var r;return e&&(e.hasClass(t)&&(r=e),!r&&n&&(r=e.ancestor(d+t))),r},ot=function(e){return e.ancestor(X)},ut=function(e,t){return st(e,j,t)},at=function(e,t){var n;return e&&(n=st(e,z,t)),n},ft=function(e,t){var n;return e&&(t?n=st(e,q,t):n=st(e,q)||e.one(d+q)),n},lt=function(e,t){var n;return e&&(n=at(e,t)||ft(e,t)),n},ct=function(e){return lt(e.one("li"))},ht=function(e){return et(e)?W:R},pt=function(e,t){return e&&!e[m]&&(e.compareTo(t)||e.contains(t))},dt=function(e,t){return e&&!e[v]&&!e.compareTo(t)&&!e.contains(t)},vt=function(){vt.superclass.constructor.apply(this,arguments)};vt.NAME="nodeMenuNav",vt.NS="menuNav",vt.SHIM_TEMPLATE_TITLE="Menu Stacking Shim",vt.SHIM_TEMPLATE='<iframe frameborder="0" tabindex="-1" class="'+i("shim")+'" title="'+vt.SHIM_TEMPLATE_TITLE+'" src="javascript:false;"></iframe>',vt.ATTRS={useARIA:{value:!0,writeOnce:!0,lazyAdd:!1,setter:function(t){var n=this.get(D),r,u,a,f;t&&(n.set(N,s),n.all("ul,li,"+$).set(N,C),n.all(d+i(o,_)).set(N,o),n.all(d+q).each(function(t){r=t,u=t.one(V),u&&(u.set(N,C),r=u.previous()),r.set(N,o),r.set("aria-haspopup",!0),a=t.next(),a&&(a.set(N,s),r=a.previous(),u=r.one(V),u&&(r=u),f=e.stamp(r),r.get(p)||r.set(p,f),a.set("aria-labelledby",f),a.set(M,!0))}))}},autoSubmenuDisplay:{value:!0,writeOnce:!0},submenuShowDelay:{value:250,writeOnce:!0},submenuHideDelay:{value:250,writeOnce:!0},mouseOutHideDelay:{value:750,writeOnce:!0}},e.extend(vt,e.Plugin.Base,{_rootMenu:null,_activeItem:null,_activeMenu:null,_hasFocus:!1,_blockMouseEvent:!1,_currentMouseX:0,_movingToSubmenu:!1,_showSubmenuTimer:null,_hideSubmenuTimer:null,_hideAllSubmenusTimer:null,_firstItem:null,initializer:function(t){var n=this,r=this.get(D),i=[],s;r&&(n._rootMenu=r,r.all("ul:first-child").addClass(T),r.all(X).addClass(F),i.push(r.on("mouseover",n._onMouseOver,n)),i.push(r.on("mouseout",n._onMouseOut,n)),i.push(r.on("mousemove",n._onMouseMove,n)),i.push(r.on(w,n._toggleSubmenuDisplay,n)),i.push(e.on("key",n._toggleSubmenuDisplay,r,"down:13",n)),i.push(r.on(S,n._toggleSubmenuDisplay,n)),i.push(r.on("keypress",n._onKeyPress,n)),i.push(r.on(E,n._onKeyDown,n)),s=r.get("ownerDocument"),i.push(s.on(w,n._onDocMouseDown,n)),i.push(s.on("focus",n._onDocFocus,n)),this._eventHandlers=i,n._initFocusManager())},destructor:function(){var t=this._eventHandlers;t&&(e.Array.each(t,function(e){e.detach()}),this._eventHandlers=null),this.get(D).unplug("focusManager")},_isRoot:function(e){return this._rootMenu.compareTo(e)},_getTopmostSubmenu:function(e){var t=this,n=ot(e),r;return n?t._isRoot(n)?r=e:r=t._getTopmostSubmenu(n):r=e,r},_clearActiveItem:function(){var e=this,t=e._activeItem;t&&t.removeClass(ht(t)),e._activeItem=null},_setActiveItem:function(e){var t=this;e&&(t._clearActiveItem(),e.addClass(ht(e)),t._activeItem=e)},_focusItem:function(e){var t=this,n,r;e&&t._hasFocus&&(n=ot(e),r=it(e),n&&!n.compareTo(t._activeMenu)&&(t._activeMenu=n,t._initFocusManager()),t._focusManager.focus(r))},_showMenu:function(t){var r=ot(t),i=t.get(a),s=i.getXY();this.get(O)&&t.set(M,!1),nt(r)?s[1]=s[1]+i.get(l):s[0]=s[0]+i.get(c),t.setXY(s),n.ie<8&&(n.ie===6&&!t.hasIFrameShim&&(t.appendChild(e.Node.create(vt.SHIM_TEMPLATE)),t.hasIFrameShim=!0),t.setStyles({height:x,width:x}),t.setStyles({height:t.get(l)+h,width:t.get(c)+h})),t.previous().addClass(U),t.removeClass(F)},_hideMenu:function(e,t){var n=this,r=e.previous(),i;r.removeClass(U),t&&(n._focusItem(r),n._setActiveItem(r)),i=e.one(d+W),i&&i.removeClass(W),e.setStyles({left:x,top:x}),e.addClass(F),n.get(O)&&e.set(M,!0)},_hideAllSubmenus:function(t){var n=this;t.all(X).each(e.bind(function(e){n._hideMenu(e)},n))},_cancelShowSubmenuTimer:function(){var e=this,t=e._showSubmenuTimer;t&&(t.cancel(),e._showSubmenuTimer=null)},_cancelHideSubmenuTimer:function(){var e=this,t=e._hideSubmenuTimer;t&&(t.cancel(),e._hideSubmenuTimer=null)},_initFocusManager:function(){var t=this,n=t._rootMenu,r=t._activeMenu||n,i=t._isRoot(r)?x:"#"+r.get("id"),s=t._focusManager,o,u,a;nt(r)?(u=i+K+","+i+Q,o={next:"down:39",previous:"down:37"}):(u=i+K,o={next:"down:40",previous:"down:38"}),s?(s.set(A,-1),s.set(k,u),s.set("keys",o)):(n.plug(e.Plugin.NodeFocusManager,{descendants:u,keys:o,circular:!0}),s=n.focusManager,a="#"+n.get("id")+X+" a,"+V,n.all(a).set("tabIndex",-1),s.on(P,this._onActiveDescendantChange,s,this),s.after(P,this._afterActiveDescendantChange,s,this),t._focusManager=s)},_onActiveDescendantChange:function(e,t){e.src===L&&t._activeMenu&&!t._movingToSubmenu&&t._hideAllSubmenus(t._activeMenu)},_afterActiveDescendantChange:function(e,t){var n;e.src===L&&(n=lt(this.get(k).item(e.newVal),!0),t._setActiveItem(n))},_onDocFocus:function(e){var t=this,n=t._activeItem,r=e.target,i;t._rootMenu.contains(r)?t._hasFocus?(i=ot(r),t._activeMenu.compareTo(i)||(t._activeMenu=i,t._initFocusManager(),t._focusManager.set(A,r),t._setActiveItem(lt(r,!0)))):(t._hasFocus=!0
,n=lt(r,!0),n&&t._setActiveItem(n)):(t._clearActiveItem(),t._cancelShowSubmenuTimer(),t._hideAllSubmenus(t._rootMenu),t._activeMenu=t._rootMenu,t._initFocusManager(),t._focusManager.set(A,0),t._hasFocus=!1)},_onMenuMouseOver:function(e,t){var n=this,r=n._hideAllSubmenusTimer;r&&(r.cancel(),n._hideAllSubmenusTimer=null),n._cancelHideSubmenuTimer(),e&&!e.compareTo(n._activeMenu)&&(n._activeMenu=e,n._hasFocus&&n._initFocusManager()),n._movingToSubmenu&&nt(e)&&(n._movingToSubmenu=!1)},_hideAndFocusLabel:function(){var e=this,t=e._activeMenu,n;e._hideAllSubmenus(e._rootMenu),t&&(n=e._getTopmostSubmenu(t),e._focusItem(n.previous()))},_onMenuMouseOut:function(e,t){var n=this,i=n._activeMenu,s=t.relatedTarget,o=n._activeItem,u,a;i&&!i.contains(s)&&(u=ot(i),u&&!u.contains(s)?n.get(B)>0&&(n._cancelShowSubmenuTimer(),n._hideAllSubmenusTimer=r(n.get(B),n,n._hideAndFocusLabel)):o&&(a=ot(o),n._isRoot(a)||n._focusItem(a.previous())))},_onMenuLabelMouseOver:function(e,t){var n=this,i=n._activeMenu,s=n._isRoot(i),o=n.get(H)&&s||!s,u=n.get("submenuShowDelay"),a,f=function(t){n._cancelHideSubmenuTimer(),n._cancelShowSubmenuTimer(),rt(e)||(a=e.next(),a&&(n._hideAllSubmenus(i),n._showSubmenuTimer=r(t,n,n._showMenu,a)))};n._focusItem(e),n._setActiveItem(e),o&&(n._movingToSubmenu?n._hoverTimer=r(u,n,function(){f(0)}):f(u))},_onMenuLabelMouseOut:function(e,t){var n=this,i=n._isRoot(n._activeMenu),s=n.get(H)&&i||!i,o=t.relatedTarget,u=e.next(),a=n._hoverTimer;a&&a.cancel(),n._clearActiveItem(),s&&(n._movingToSubmenu&&!n._showSubmenuTimer&&u?n._hideSubmenuTimer=r(n.get("submenuHideDelay"),n,n._hideMenu,u):!n._movingToSubmenu&&u&&(!o||o&&!u.contains(o)&&!o.compareTo(u))&&(n._cancelShowSubmenuTimer(),n._hideMenu(u)))},_onMenuItemMouseOver:function(e,t){var n=this,r=n._activeMenu,i=n._isRoot(r),s=n.get(H)&&i||!i;n._focusItem(e),n._setActiveItem(e),s&&!n._movingToSubmenu&&n._hideAllSubmenus(r)},_onMenuItemMouseOut:function(e,t){this._clearActiveItem()},_onVerticalMenuKeyDown:function(e){var t=this,n=t._activeMenu,r=t._rootMenu,i=e.target,s=!1,o=e.keyCode,u,f,l,c;switch(o){case 37:f=ot(n),f&&nt(f)?(t._hideMenu(n),l=G(n.get(a)),c=lt(l),c&&(tt(c)?(u=c.next(),u?(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))):(t._focusItem(c),t._setActiveItem(c))):(t._focusItem(c),t._setActiveItem(c)))):t._isRoot(n)||t._hideMenu(n,!0),s=!0;break;case 39:tt(i)?(u=i.next(),u&&(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u)))):nt(r)&&(u=t._getTopmostSubmenu(n),l=Y(u.get(a)),c=lt(l),t._hideAllSubmenus(r),c&&(tt(c)?(u=c.next(),u?(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))):(t._focusItem(c),t._setActiveItem(c))):(t._focusItem(c),t._setActiveItem(c)))),s=!0}s&&e.preventDefault()},_onHorizontalMenuKeyDown:function(e){var t=this,n=t._activeMenu,r=e.target,i=lt(r,!0),s=!1,o=e.keyCode,u;o===40&&(t._hideAllSubmenus(n),tt(i)&&(u=i.next(),u&&(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))),s=!0)),s&&e.preventDefault()},_onMouseMove:function(e){var t=this;r(10,t,function(){t._currentMouseX=e.pageX})},_onMouseOver:function(e){var t=this,n,r,i,s,o;t._blockMouseEvent?t._blockMouseEvent=!1:(n=e.target,r=ut(n,!0),i=ft(n,!0),o=at(n,!0),pt(r,n)&&(t._onMenuMouseOver(r,e),r[m]=!0,r[v]=!1,s=ot(r),s&&(s[v]=!0,s[m]=!1)),pt(i,n)&&(t._onMenuLabelMouseOver(i,e),i[m]=!0,i[v]=!1),pt(o,n)&&(t._onMenuItemMouseOver(o,e),o[m]=!0,o[v]=!1))},_onMouseOut:function(e){var t=this,n=t._activeMenu,r=!1,i,s,o,u,a,f;t._movingToSubmenu=n&&!nt(n)&&e.pageX-5>t._currentMouseX,i=e.target,s=e.relatedTarget,o=ut(i,!0),u=ft(i,!0),f=at(i,!0),dt(u,s)&&(t._onMenuLabelMouseOut(u,e),u[v]=!0,u[m]=!1),dt(f,s)&&(t._onMenuItemMouseOut(f,e),f[v]=!0,f[m]=!1),u&&(a=u.next(),a&&s&&(s.compareTo(a)||a.contains(s))&&(r=!0));if(dt(o,s)||r)t._onMenuMouseOut(o,e),o[v]=!0,o[m]=!1},_toggleSubmenuDisplay:function(e){var t=this,r=e.target,i=ft(r,!0),s=e.type,o,u,a,f,l,c;if(i){o=Z(r)?r:r.ancestor(Z);if(o){a=o.getAttribute("href",2),f=a.indexOf("#"),l=a.length;if(f===0&&l>1){c=a.substr(1,l),u=i.next();if(u&&u.get(p)===c){if(s===w||s===E)(n.opera||n.gecko||n.ie)&&s===E&&!t._preventClickHandle&&(t._preventClickHandle=t._rootMenu.on("click",function(e){e.preventDefault(),t._preventClickHandle.detach(),t._preventClickHandle=null})),s==w&&(e.preventDefault(),e.stopImmediatePropagation(),t._hasFocus=!0),t._isRoot(ot(r))?rt(i)?(t._hideMenu(u),t._focusItem(i),t._setActiveItem(i)):(t._hideAllSubmenus(t._rootMenu),t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))):t._activeItem==i?(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))):i._clickHandle||(i._clickHandle=i.on("click",function(){t._hideAllSubmenus(t._rootMenu),t._hasFocus=!1,t._clearActiveItem(),i._clickHandle.detach(),i._clickHandle=null}));s===S&&e.preventDefault()}}}}},_onKeyPress:function(e){switch(e.keyCode){case 37:case 38:case 39:case 40:e.preventDefault()}},_onKeyDown:function(e){var t=this,i=t._activeItem,s=e.target,o=ot(s),u;o&&(t._activeMenu=o,nt(o)?t._onHorizontalMenuKeyDown(e):t._onVerticalMenuKeyDown(e),e.keyCode===27&&(t._isRoot(o)?i&&(tt(i)&&rt(i)?(u=i.next(),u&&t._hideMenu(u)):(t._focusManager.blur(),t._clearActiveItem(),t._hasFocus=!1)):(n.opera?r(0,t,function(){t._hideMenu(o,!0)}):t._hideMenu(o,!0),e.stopPropagation(),t._blockMouseEvent=n.gecko?!0:!1)))},_onDocMouseDown:function(e){var t=this,r=t._rootMenu,i=e.target;!r.compareTo(i)&&!r.contains(i)&&(t._hideAllSubmenus(r),n.webkit&&(t._hasFocus=!1,t._clearActiveItem()))}}),e.namespace("Plugin"),e.Plugin.NodeMenuNav=vt},"3.9.1",{requires:["node","classnamemanager","plugin","node-focusmanager"],skinnable:!0});

/* lp/app/javascript/autocomplete/autocomplete-min.js */

YUI.add('lp.ui.autocomplete',function(Y){Y.namespace('lp.ui.autocomplete');var AUTOCOMP='autocomplete',BOUNDING_BOX='boundingBox',CONTENT_BOX='contentBox',INPUT='input',VALUE='value',QUERY='query',DATA='data',MATCHES='matches',RENDERED='rendered',DELIMITER='delimiter',TAB=9,RETURN=13,ESCAPE=27,ARROW_DOWN=40,getCN=Y.ClassNameManager.getClassName,C_LIST=getCN(AUTOCOMP,'list');var AutoCompleteBase=Y.Base.build("AutoCompleteBase",Y.Widget,[Y.WidgetStack]);function AutoComplete(){AutoComplete.superclass.constructor.apply(this,arguments);}
AutoComplete.NAME='autocomplete';AutoComplete.LIST_TEMPLATE='<ul></ul>';AutoComplete.ITEM_TEMPLATE='<li class="item yui3-menuitem"></li>';AutoComplete.ITEM_CONTENT_TEMPLATE=('<a href="#" class="yui3-menuitem-content"></a>');AutoComplete.ATTRS={data:{valueFn:function(){return{};}},delimiter:{value:' '},matches:{valueFn:function(){return[];}},input:{value:null,setter:function(val){return this._setInput(val);}},query:{value:null}};Y.extend(AutoComplete,AutoCompleteBase,{_completions:null,_last_input_was_completed:false,initializer:function(){this.hide();},destructor:function(){var input=this.get('INPUT');if(input&&this.get(RENDERED)){input.detach('keydown',this._onInputKeydown);input.detach('keyup',this._onInputKeyup);}},renderUI:function(){var input=this.get(INPUT);var bounding_box=this.get(BOUNDING_BOX);bounding_box.addClass("yui3-menu");Y.one('body').appendChild(bounding_box);this.get(CONTENT_BOX).setStyle('minWidth',input.get('offsetWidth')+"px").addClass('yui3-menu-content');var iregion=input.get('region');bounding_box.setStyles({'left':iregion.left+'px','top':iregion.bottom+'px'});input.setAttribute('autocomplete','off');},_renderCompletions:function(query){var matches=this.get(MATCHES);if(!this.get(RENDERED)||!matches){return;}
var list=Y.Node.create(AutoComplete.LIST_TEMPLATE);list.addClass(C_LIST);var result;var item;var match;var idx;for(idx=0;idx<matches.length;idx++){match=matches[idx];result=this.formatResult(match.text,query,match.offset);item=this._renderCompletion(result,idx);list.appendChild(item);}
var cbox=this.get(CONTENT_BOX);var box=this.get(BOUNDING_BOX);box.unplug(Y.Plugin.NodeMenuNav);if(this._completions){cbox.replaceChild(list,this._completions);}else{cbox.appendChild(list);}
box.plug(Y.Plugin.NodeMenuNav);box.setStyle('z-index','31000');this._selectItem(0,false);this._completions=list;},_renderCompletion:function(html_content,item_index){var item=Y.Node.create(AutoComplete.ITEM_TEMPLATE);item.setAttribute('id',this._makeItemID(item_index));var link=Y.Node.create(AutoComplete.ITEM_CONTENT_TEMPLATE);link.set('innerHTML',html_content);item.appendChild(link);return item;},_makeItemID:function(index){return'item'+index;},_indexForItem:function(item){var id=parseInt(item.getAttribute('id').replace('item',''),10);return Y.Lang.isNumber(id)?id:null;},bindUI:function(){var input=this.get(INPUT);input.on('keydown',this._onInputKeydown,this);input.on('keyup',this._onInputKeyup,this);this.get('contentBox').on('click',this._onListClick,this);},parseQuery:function(input,caret_pos){if(caret_pos<=0){return null;}
if(!Y.Lang.isNumber(caret_pos)||(caret_pos>input.length)){caret_pos=input.length;}
var delimiter=this.get(DELIMITER);var start=input.lastIndexOf(delimiter,caret_pos-1);var end=input.indexOf(delimiter,caret_pos-1);if((start===end)&&(start!==-1)){return null;}
if(start===-1){start=0;}else{start++;}
if(end===-1){end=input.length;}
while((input[start]===' '||input[start]==='\t')&&(start<=end)){start++;}
if(start===end){return null;}
var query={text:input.substring(start,end),offset:start};return query;},findMatches:function(query){var matches=this.filterResults(this.get(DATA),query);this.set(MATCHES,matches);return matches;},filterResults:function(data,query){var midx;var match_key;var match_string;var start_indicies=[];var lowercase_query=query.toLowerCase();if(data){Y.Array.each(data,function(match_key){match_string=match_key.toString();midx=match_string.toLowerCase().indexOf(lowercase_query);if(midx>-1){if(!start_indicies[midx]){start_indicies[midx]=[];}
start_indicies[midx].push(match_string);}});}
var matches=[];Y.Array.each(start_indicies,function(match_set,index){if(match_set){Y.Array.each(match_set,function(match){matches.push({text:match,offset:index});});}});return matches;},formatResult:function(result,query,offset){return this.markMatchingText(result,query,offset);},markMatchingText:function(text,query,offset){var start=offset;if(start<0||!query){return text;}
var end=start+query.length;var before=text.substring(0,start);var match=text.substring(start,end);var after=text.substring(end);match='<span class="matching-text">'+match+'</span>';return before+match+after;},completeInput:function(){var active_item=this.getActiveItem();if(active_item){var item_index=this._indexForItem(active_item);if(item_index!==null){this.completeInputUsingItem(item_index);}}else{this.completeInputUsingItem(0);}
this.get(INPUT).focus();this._last_input_was_completed=true;},completeInputUsingItem:function(match_num){var matches=this.get(MATCHES);if(matches.length===0){return;}
if(match_num>=matches.length){Y.fail("Failed to complete item number "+match_num+" because there are only "+matches.length+" matches "+"available.");return;}
var completion_txt=matches[match_num].text;var query=this.get(QUERY);var delimiter=this.get(DELIMITER);var input=this.get(INPUT);var input_txt=input.get('value');var query_end=query.offset+query.text.length;var input_head=input_txt.substring(0,query.offset);var input_tail=input_txt.substring(query_end,input_txt.length);var tail_delimiter=delimiter;if(input_tail.charAt(input_tail.length-1)===delimiter){tail_delimiter='';}
var new_input=[input_head,completion_txt,input_tail,tail_delimiter].join('');input.set(VALUE,new_input);this.hide();},getActiveItem:function(){var menu=this.get(BOUNDING_BOX).menuNav;if(menu){return menu._activeItem?menu._activeItem:null;}
return null;},_selectItem:function(index,set_focus){var menu=this.get(BOUNDING_BOX).menuNav;var firstItem=menu._rootMenu.all('.yui3-menuitem').item(0);var item=menu?firstItem:null;if(!menu||!item){return null;}
var idx;for(idx=0;idx<index;idx++){item=item.next();if(!item){return null;}}
if(set_focus){var anchor=item.one('a');menu._focusManager.set("activeDescendant",anchor);menu._focusItem(item);if(anchor){Y.later(5,anchor,anchor.focus);}}
menu._setActiveItem(item);return item;},_setInput:function(elem){var node=Y.one(elem);if(node===null){return null;}
Y.augment(node,Y.lp.ui.NodeCaretPos);return node;},_onInputKeyup:function(e){var input=this.get(INPUT);var caret_pos=null;if(input.getCaretPos!==undefined){caret_pos=input.getCaretPos();}
var query=this.parseQuery(input.get(VALUE),caret_pos);this.set(QUERY,query);if(e.keyCode===ESCAPE||e.keyCode===RETURN||e.keyCode===TAB||e.keyCode===ARROW_DOWN){return;}
if(query===null){this._last_input_was_completed=false;this.hide();return;}
if(this.findMatches(query.text).length!==0){this._renderCompletions(query.text);this._last_input_was_completed=false;this.show();}else{this.hide();}},_onInputKeydown:function(e){if(e.keyCode===TAB||e.keyCode===RETURN){if(this.get(QUERY)!==null&&!this._last_input_was_completed&&this.findMatches(this.get(QUERY).text).length!==0){this.completeInput();e.preventDefault();}}else if(e.keyCode===ESCAPE){this.hide();}else if(e.keyCode===ARROW_DOWN){this._selectItem(1,true);e.preventDefault();}},_onListClick:function(e){this.completeInput();e.preventDefault();}});Y.lp.ui.AutoComplete=AutoComplete;Y.lp.ui.NodeCaretPos=function(){};Y.lp.ui.NodeCaretPos.prototype.getCaretPos=function(){var elem=Y.Node.getDOMNode(this);if(elem.selectionEnd){return elem.selectionEnd;}else if(document.selection){var range=document.selection.createRange();if(range.parentElement()===elem){var end_range=range.duplicate();end_range.moveStart("character",-elem.value.length);return end_range.text.length;}}
return null;};},"0.1",{"skinnable":true,"requires":["oop","base","event","widget","widget-stack","node-menunav"]});
/* lp/bugs/javascript/bug_tags_entry-min.js */

YUI.add('lp.bugs.tags_entry',function(Y){var namespace=Y.namespace('lp.bugs.tags_entry');var bug_tags_div;var tags_heading;var tags_trigger;var tag_list_span;var tag_input;var ok_button;var cancel_button;var tags_edit_spinner;var tags_form;var available_tags;var autocomplete;var A='a',VALUE='value',BUG='bug',INNER_HTML='innerHTML',ESCAPE=27,HIDDEN='hidden';var populate_tags_input=function(){var tags=[];tag_list_span.all(A).each(function(anchor){tags.push(anchor.get(INNER_HTML));});var tag_list=tags.join(' ');if(tag_list!==""){tag_list+=' ';}
tag_input.set(VALUE,tag_list);};var base_url=window.location.href.split('/+bug')[0]+'/+bugs?field.tag=';namespace.parse_tags=function(tag_string){var tags=Y.Array.filter(Y.Lang.trim(tag_string).split(new RegExp('\\s+')),function(elem){return elem!=='';});return tags;};namespace.lp_config={};var save_tags=function(){var lp_client=new Y.lp.client.Launchpad(namespace.lp_config);var tags=namespace.parse_tags(tag_input.get(VALUE));var bug=new Y.lp.client.Entry(lp_client,LP.cache[BUG],LP.cache[BUG].self_link);bug.removeAttr('http_etag');bug.set('tags',tags);namespace.show_activity(true);bug.lp_save({on:{success:function(updated_entry){var official_tags=[];var unofficial_tags=[];Y.each(updated_entry.get('tags'),function(tag){if(Y.Array.indexOf(available_tags,tag)>-1){official_tags.push(tag);}else{unofficial_tags.push(tag);}});official_tags.sort();unofficial_tags.sort();var tags_html=Y.Array.map(official_tags,function(tag){return Y.Lang.sub('<a href="{tag_url}" class="official-tag">{tag}</a>',{tag_url:base_url+tag,tag:tag});}).join(' ')+' '+Y.Array.map(unofficial_tags,function(tag){return Y.Lang.sub('<a href="{tag_url}" class="unofficial-tag">{tag}</a>',{tag_url:base_url+tag,tag:tag});}).join(' ');tag_list_span.set(INNER_HTML,tags_html);tag_list_span.removeClass(HIDDEN);tags_trigger.removeClass(HIDDEN);namespace.show_activity(false);tags_form.addClass(HIDDEN);Y.lp.anim.green_flash({node:tag_list_span}).run();namespace.update_ui();},failure:function(id,request){namespace.show_activity(false);Y.lp.anim.red_flash({node:tag_list_span}).run();}}});};var cancel=function(){tag_list_span.removeClass(HIDDEN);tags_trigger.removeClass(HIDDEN);tags_form.addClass(HIDDEN);autocomplete.hide();Y.lp.anim.green_flash({node:tag_list_span}).run();namespace.update_ui();};var edit=function(){populate_tags_input();tag_list_span.addClass(HIDDEN);tags_trigger.addClass(HIDDEN);tags_form.removeClass(HIDDEN);tag_input.focus();autocomplete.render();};namespace.show_activity=function(active){if(active){tags_edit_spinner.removeClass(HIDDEN);ok_button.addClass(HIDDEN);cancel_button.addClass(HIDDEN);}else{tags_edit_spinner.addClass(HIDDEN);ok_button.removeClass(HIDDEN);cancel_button.removeClass(HIDDEN);}};namespace.update_ui=function(){if(Y.Lang.trim(tag_list_span.get('innerHTML'))===''){tags_heading.set('text','');tags_trigger.setAttrs({'text':'Add tags','title':'Add tags'});tags_trigger.removeClass('edit');tags_trigger.removeClass('action-icon');tags_trigger.addClass('add');}else{tags_heading.set('text','Tags:');tags_trigger.setAttrs({'text':'Edit','title':'Edit tags'});tags_trigger.removeClass('add');tags_trigger.addClass('edit');tags_trigger.addClass('action-icon');}};namespace.setup_tag_entry=function(available_official_tags){if(LP.links.me===undefined){return;}
available_tags=available_official_tags;bug_tags_div=Y.one('#bug-tags');tags_heading=bug_tags_div.one('#tags-heading');tags_trigger=bug_tags_div.one('#tags-trigger');tag_list_span=bug_tags_div.one('#tag-list');tag_input=Y.Node.create('<input type="text" id="tag-input" />');tags_edit_spinner=Y.Node.create('<img src="/@@/spinner" id="tags-edit-spinner" class="hidden" />');ok_button=Y.Node.create('<button class="lazr-pos lazr-btn yui-ieditor-submit_button" '+'id="edit-tags-ok" type="button">Ok</button>');cancel_button=Y.Node.create('<button class="lazr-neg lazr-btn yui-ieditor-cancel_button" '+'id="edit-tags-cancel" type="button">Cancel</button>');tags_form=Y.Node.create('<form id="tags-form" class="inline hidden"></form>');tags_form.append(new Y.NodeList([tag_input,tags_edit_spinner,ok_button,cancel_button]));tag_list_span.insert(tags_form,'after');tag_input.on('keydown',function(e){if(e.keyCode===ESCAPE){e.halt();cancel();}});ok_button.on('click',function(e){e.halt();save_tags();if(!autocomplete._last_input_was_completed){autocomplete.hide();}});cancel_button.on('click',function(e){e.halt();cancel();});tags_form.on('submit',function(e){e.halt();save_tags();});tags_trigger.on('click',function(e){e.halt();edit();});tags_trigger.addClass('js-action');autocomplete=namespace.setup_tag_complete('#tag-input',available_official_tags);};namespace.setup_tag_complete=function(input,official_tags){var bounding_box=Y.Node.create('<div class="bug-tag-complete"><div></div></div>');Y.one('body').appendChild(bounding_box);var autocomplete=new Y.lp.ui.AutoComplete({input:input,data:official_tags,boundingBox:bounding_box,contentBox:bounding_box.one('div')});autocomplete.get('input').on('focus',function(e){autocomplete.render();});return autocomplete;};},"0.1",{"requires":["array-extras","base","io-base","node","substitute","node-menunav","lp.anim","lp.ui.autocomplete","lp.client"]});
